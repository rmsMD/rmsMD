<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Standard workflow with restricted cubic splines • rmsMD</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Standard workflow with restricted cubic splines">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rmsMD</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Standard_workflow_with_restricted_cubic_splines.html">Standard workflow with restricted cubic splines</a></li>
    <li><a class="dropdown-item" href="../articles/Further_details_modelsummary_rms.html">Further details: modelsummary_rms</a></li>
    <li><a class="dropdown-item" href="../articles/Further_details_ggrmsMD.html">Further details: ggrmsMD</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sjtingle/rmsMD/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Standard workflow with restricted cubic splines</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sjtingle/rmsMD/blob/master/vignettes/Standard_workflow_with_restricted_cubic_splines.Rmd" class="external-link"><code>vignettes/Standard_workflow_with_restricted_cubic_splines.Rmd</code></a></small>
      <div class="d-none name"><code>Standard_workflow_with_restricted_cubic_splines.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/rms/" class="external-link">rms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rmsMD/rmsMD" class="external-link">rmsMD</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>modelsummary_rms</code> function is designed to process
output from models fitted using the <strong>rms</strong> package and
generate a summarised dataframe of the results. The goal is to produce
publication-ready summaries of the models. The <code>ggrmsMD</code>
function generates publication ready plots of variables modelled with
restricted cubic splines.</p>
<p>This vignette will guide you through the basic usage of the functions
on a model including restricted cubic splines.</p>
<div class="section level3">
<h3 id="installation-and-setup">Installation and Setup<a class="anchor" aria-label="anchor" href="#installation-and-setup"></a>
</h3>
<p>For these vignettes we will use a simulated dataset to predict the
impact of age, BMI, Sex and Smoking status on outcome after surgery. The
models are for illustration purposes only. Note, if you plan to output
the results into Microsoft Word, we recommend also installing flextable
and officer.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load in the simulated data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulated_rmsMD_data.html">simulated_rmsMD_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the datadist which is required for rms modelling </span></span>
<span><span class="co"># (these two lines are standard)</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/datadist.html" class="external-link">datadist</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>    </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>datadist<span class="op">=</span><span class="st">'dd'</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-model-with-restricted-cubic-splines">Fitting Model with Restricted Cubic Splines<a class="anchor" aria-label="anchor" href="#fitting-model-with-restricted-cubic-splines"></a>
</h3>
<p>Restricted Cubic Splines (RCS) are a flexible modelling tool used to
capture non-linear relationships between predictors and outcomes. In
medicine, for the majority of continuous variables (e.g. age, blood
pressure, or biomarker levels) the assumption of linearity may not hold.
A key highlight of the <strong>rms</strong> package is the ability to
analyse variables using RCS.</p>
<p>The <strong>rmsMD</strong> package is designed to report and
summarise models that include RCS terms. Here is an example model
predicting occurrence of complications after surgery (binary), with the
continuous variables age and BMI modelled using restricted cubic splines
with 4 knots:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit an OLS model including a restricted cubic spline </span></span>
<span><span class="co"># for Age and BMI (with 4 knots)</span></span>
<span><span class="va">fit_lrm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/lrm.html" class="external-link">lrm</a></span><span class="op">(</span><span class="va">majorcomplication</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html" class="external-link">rcs</a></span><span class="op">(</span><span class="va">age</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html" class="external-link">rcs</a></span><span class="op">(</span><span class="va">bmi</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                 <span class="va">sex</span> <span class="op">+</span> </span>
<span>                 <span class="va">smoking</span>, </span>
<span>               data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="intuitive-output-with-modelsummary_rms">Intuitive output with modelsummary_rms<a class="anchor" aria-label="anchor" href="#intuitive-output-with-modelsummary_rms"></a>
</h3>
<p>Individual coefficients for RCS terms are difficult to interpret in
isolation. Instead, an overall p-value can be generated to assess
whether the overall relationship between the RCS variable and outcome is
significant. By default <code>modelsummary_rms</code> removes the
individual RCS coefficients, replacing them with the overall p-value for
that variable.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate an rmsMD model summary using default settings</span></span>
<span><span class="fu"><a href="../reference/modelsummary_rms.html">modelsummary_rms</a></span><span class="op">(</span><span class="va">fit_lrm</span><span class="op">)</span></span>
<span><span class="co">#&gt; RCS overall p-values displayed are from Wald tests.</span></span>
<span><span class="co">#&gt; To use the recommended test for this model type (LR test),</span></span>
<span><span class="co">#&gt; please set 'x = TRUE, y = TRUE' when fitting the model.</span></span>
<span><span class="co">#&gt;           variable                OR_95CI Pvalue</span></span>
<span><span class="co">#&gt; 1       sex=Female                    Ref      -</span></span>
<span><span class="co">#&gt; 2         sex=Male 1.078 (0.927 to 1.255)  0.330</span></span>
<span><span class="co">#&gt; 3    smoking=Never                    Ref      -</span></span>
<span><span class="co">#&gt; 4   smoking=Former 0.986 (0.806 to 1.207)  0.892</span></span>
<span><span class="co">#&gt; 5  smoking=Current 2.078 (1.731 to 2.496) &lt;0.001</span></span>
<span><span class="co">#&gt; 6 RCSoverallP: age              Wald test &lt;0.001</span></span>
<span><span class="co">#&gt; 7 RCSoverallP: bmi              Wald test  0.030</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Outputting this as a table</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/modelsummary_rms.html">modelsummary_rms</a></span><span class="op">(</span><span class="va">fit_lrm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; RCS overall p-values displayed are from Wald tests.</span></span>
<span><span class="co">#&gt; To use the recommended test for this model type (LR test),</span></span>
<span><span class="co">#&gt; please set 'x = TRUE, y = TRUE' when fitting the model.</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">variable</th>
<th align="left">OR_95CI</th>
<th align="left">Pvalue</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sex=Female</td>
<td align="left">Ref</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">sex=Male</td>
<td align="left">1.078 (0.927 to 1.255)</td>
<td align="left">0.330</td>
</tr>
<tr class="odd">
<td align="left">smoking=Never</td>
<td align="left">Ref</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">smoking=Former</td>
<td align="left">0.986 (0.806 to 1.207)</td>
<td align="left">0.892</td>
</tr>
<tr class="odd">
<td align="left">smoking=Current</td>
<td align="left">2.078 (1.731 to 2.496)</td>
<td align="left">&lt;0.001</td>
</tr>
<tr class="even">
<td align="left">RCSoverallP: age</td>
<td align="left">Wald test</td>
<td align="left">&lt;0.001</td>
</tr>
<tr class="odd">
<td align="left">RCSoverallP: bmi</td>
<td align="left">Wald test</td>
<td align="left">0.030</td>
</tr>
</tbody>
</table>
<p>P values for restricted cubic spline terms in these outputs indicate
whether there is an association between the predictor and outcome.
Please note that this association can be <em>either</em> linear or
non-linear. The P value reflects the presence of an association, not its
shape. We recommend that these associations are then plotted using the
<code>ggrmsMD</code> function, shown below, to assess the nature of
these relationships.</p>
</div>
<div class="section level3">
<h3 id="plotting-with-ggrmsmd">Plotting with ggrmsMD<a class="anchor" aria-label="anchor" href="#plotting-with-ggrmsmd"></a>
</h3>
<p>Now that the model and overall p values have been assessed, the
<code>ggrmsMD</code> function from <strong>rmsMD</strong> can be used to
assess the relationship between variables modelled with restricted cubic
splines, and the outcome.</p>
<p>As a minimum, the model fit and data should be passed into the
function. <code>ggrmsMD</code> will then generate plots for all
variables which were modelled with restricted cubic splines. The default
behavior is to plot: predicted outcome for linear regression models,
adjusted OR for logistic regression, and adjusted HR for Cox regression.
All of these plots are adjusted for all other variables in the
model.</p>
<p>Here is the most basic use case with the logistic regression model
for post-operative complications above:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Most basic output</span></span>
<span><span class="fu"><a href="../reference/ggrmsMD.html">ggrmsMD</a></span><span class="op">(</span><span class="va">fit_lrm</span>, <span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p><img src="Standard_workflow_with_restricted_cubic_splines_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>Further arguments in <code>ggrmsMD</code> allow these plots to be
editted into a publication ready format. Example of a publication ready
plot:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># x axis labels can be stored in a list</span></span>
<span><span class="va">xlabels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="st">"age"</span> <span class="op">=</span> <span class="st">"Age (years)"</span>,</span>
<span>                 <span class="st">"bmi"</span> <span class="op">=</span> <span class="st">"Body Mass Index"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># titles for each variable can be stored in a list</span></span>
<span><span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="st">"age"</span> <span class="op">=</span> <span class="st">"Impact of Age on Complications"</span>,</span>
<span>                 <span class="st">"bmi"</span> <span class="op">=</span> <span class="st">"Impact of BMI on Complications"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ggrmsMD.html">ggrmsMD</a></span><span class="op">(</span><span class="va">fit_lrm</span>, <span class="va">data</span>,</span>
<span>        <span class="co"># set y axis label for all plots</span></span>
<span>        ylab <span class="op">=</span> <span class="st">"Complications (adjusted OR)"</span>, </span>
<span>        <span class="co"># set y axis limits</span></span>
<span>        ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>        <span class="co"># set higher OR as inferior outcome to assign red shading</span></span>
<span>        shade_inferior <span class="op">=</span> <span class="st">"higher"</span>, </span>
<span>        <span class="co"># set x axis labels for each variable</span></span>
<span>        xlabs <span class="op">=</span> <span class="va">xlabels</span>, </span>
<span>        <span class="co"># set titles for each variable</span></span>
<span>        titles <span class="op">=</span> <span class="va">titles</span> </span>
<span>        <span class="op">)</span></span></code></pre></div>
<p><img src="Standard_workflow_with_restricted_cubic_splines_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>Further arguments allow for log transformation of axes, selection of
which variables are included, option to output plot lists rather than
combined plots, ability to plot predicted probability rather than OR,
etc. For further details please see the vignette
<strong>Further_details_ggrmsMD</strong>. Outputted plots are ggplots,
and therefore can be further adapted using that framework.</p>
</div>
<div class="section level3">
<h3 id="exporting-to-microsoft-word">Exporting to Microsoft Word<a class="anchor" aria-label="anchor" href="#exporting-to-microsoft-word"></a>
</h3>
<p>The output of <code>modelsummary_rms</code> is a dataframe, as this
is easy to work with and further process if required. This dataframe
output can easily be exported to a word document using
<strong>flextable</strong> and <strong>officer</strong> packages.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/officeverse/" class="external-link">officer</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/flextable-book/" class="external-link">flextable</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:Hmisc':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     src, summarize</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="co"># Convert modelsummary_rms dataframe to a flextable</span></span>
<span><span class="va">rmsMD_as_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html" class="external-link">flextable</a></span><span class="op">(</span><span class="fu"><a href="../reference/modelsummary_rms.html">modelsummary_rms</a></span><span class="op">(</span><span class="va">fit_lrm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; RCS overall p-values displayed are from Wald tests.</span></span>
<span><span class="co">#&gt; To use the recommended test for this model type (LR test),</span></span>
<span><span class="co">#&gt; please set 'x = TRUE, y = TRUE' when fitting the model.</span></span>
<span></span>
<span><span class="co"># Create a new Word document, add table and a heading</span></span>
<span><span class="va">doc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://davidgohel.github.io/officer/reference/read_docx.html" class="external-link">read_docx</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/body_add_flextable.html" class="external-link">body_add_flextable</a></span><span class="op">(</span><span class="va">rmsMD_as_table</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/officer/reference/body_add_par.html" class="external-link">body_add_par</a></span><span class="op">(</span><span class="st">"Model summary from rmsMD"</span>, style <span class="op">=</span> <span class="st">"heading 2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Temporary file path for output (replace with your actual path as needed)</span></span>
<span><span class="va">output_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"example_output.docx"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate the Word document</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">doc</span>, target <span class="op">=</span> <span class="va">output_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Alternatively, save as 'temp.docx' in the working directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">doc</span>, target <span class="op">=</span> <span class="st">"temp.docx"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://scholar.google.com/citations?user=op7Z53gAAAAJ&amp;hl=en&amp;oi=ao" class="external-link">Samuel Tingle</a>, <a href="https://scholar.google.com/citations?user=X6Q-y3EAAAAJ&amp;hl=en&amp;oi=ao" class="external-link">Georgios Kourounis</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
